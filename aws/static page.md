# awsで独自ドメインで静的ページをhttpsで公開する

## 前提
お名前ドットコムでドメインを取得している

## 最終形
- コンテンツはAWS
-  dnsはお名前ドットコムのサーバー

## 作業
### 1. S3バケット
S3バケットを使用するのでバケットを作成する
この際、バケットは非公開で作成する
```
バケットネームは世界中で一意でないといけない
-> 公開した場合、バケット名がURLの一部に含まれるため
なのでGUIDを含めるのがベストプラクティスっぽい
まぁ独自にドメインあるならそれでも良いような
とにかく一意でなければならない
```

作成したバケットにコンテンツ(HTMLファイルとか)をアップロードする

### 2. ACM(Aws Certificate Manager)
証明書を取得する、この時のリージョンは下記の通り
``` warning
絶対に「米国(バージニア北部)」でリクエストする事！！
```
Cloudfrontのみリージョンに制限があるようだ

1. ドメイン名(**FQDN**)を入力してリクエスト
2. するとCNAMEとCNAME値が表示されるのでコピペしてお名前ドットコムのDNSに設定する
3. しばらくすると発行される(数分)


### 3. CloudFron
#### 3.1 OAC(Origin Access Control)を作成する
1. 左ペインからセキュリティ -> オリジンアクセス
2. オリジンタイプにS3を選択する

#### 3.2 OAC(Origin Access Control)を作成する
ディストリビューションを作成する
1. オリジンドメインに公開したいS3バケットを選択する
2. 代替ドメイン(CNAME)に独自ドメイン(FQDN)を入力する
3. Custom SSL certificateにACMで作成した証明書を選択する
#### 3.3 S3バケット(ポリシー)
ディストリビューションを作成すると画面上部にS3のポリシーに関するメッセージが表示されるのでクリックする
表示されたポリシーをコピーして、S3のバケットのアクセス許可 -> バケットポリシーに張り付ける

ここまでで、ディストリビューションは公開されているはず

### 4. dns
お名前ドットコムのdnsにCNAMEを設定する
1. 名前はホスト名(ex. www)、値に作成したディストリビューションドメイン名(ex. 123456.cloudfront.net)